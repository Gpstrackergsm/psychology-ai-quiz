<div id="mindmatch-embed">
  <div id="mindmatch-spinner">
    <div class="mindmatch-spinner__icon" aria-hidden="true"></div>
    <p>Loadingâ€¦</p>
  </div>

  <iframe
    id="mindmatch-iframe"
    src="https://psychology-ai-quiz.netlify.app"
    title="MindMatch Quiz"
    loading="lazy"
    allow="fullscreen"
  ></iframe>
</div>

<style>
  :root {
    --mindmatch-vh: 100vh;
  }

  #mindmatch-embed {
    position: relative;
    width: 100%;
    height: calc(var(--mindmatch-vh) * 1);
    min-height: calc(var(--mindmatch-vh) * 1);
    overflow: hidden;
    display: flex;
    align-items: stretch;
    justify-content: center;
    background: #0f172a;
    color: #f8fafc;
  }

  #mindmatch-iframe {
    flex: 1 1 auto;
    width: 100%;
    height: 100%;
    border: 0;
    display: block;
    background: #fff;
  }

  #mindmatch-spinner {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    background: rgba(15, 23, 42, 0.94);
    color: #f8fafc;
    font-family: "Inter", "Helvetica Neue", Helvetica, Arial, sans-serif;
    font-size: 1.05rem;
    letter-spacing: 0.01em;
    transition: opacity 260ms ease, visibility 260ms ease;
    z-index: 2;
  }

  #mindmatch-spinner.is-hidden {
    opacity: 0;
    visibility: hidden;
  }

  .mindmatch-spinner__icon {
    width: 2.75rem;
    height: 2.75rem;
    border-radius: 50%;
    border: 3px solid rgba(248, 250, 252, 0.3);
    border-top-color: #38bdf8;
    animation: mindmatch-spin 0.8s linear infinite;
  }

  @keyframes mindmatch-spin {
    to {
      transform: rotate(360deg);
    }
  }
</style>

<script>
  (function () {
    var SOURCE_ID = 'mindmatch-quiz';
    var embed = document.getElementById('mindmatch-embed');
    var iframe = document.getElementById('mindmatch-iframe');
    var spinner = document.getElementById('mindmatch-spinner');
    var raf = null;

    function setViewportHeight() {
      if (!embed || !iframe) {
        return;
      }
      var vh = window.innerHeight;
      if (typeof vh !== 'number' || !isFinite(vh) || vh <= 0) {
        vh = iframe.clientHeight || embed.clientHeight || 600;
      }
      embed.style.height = vh + 'px';
      embed.style.minHeight = vh + 'px';
      iframe.style.height = vh + 'px';
      document.documentElement.style.setProperty('--mindmatch-vh', vh + 'px');
    }

    function applyContentHeight(nextHeight) {
      if (!embed || !iframe || typeof nextHeight !== 'number' || !isFinite(nextHeight)) {
        return;
      }
      var targetHeight = Math.max(nextHeight, window.innerHeight || 0);
      if (raf) {
        cancelAnimationFrame(raf);
      }
      raf = requestAnimationFrame(function () {
        embed.style.height = targetHeight + 'px';
        embed.style.minHeight = targetHeight + 'px';
        iframe.style.height = targetHeight + 'px';
        document.documentElement.style.setProperty('--mindmatch-vh', targetHeight + 'px');
      });
    }

    function handleMessage(event) {
      if (!event || !event.data || event.data.source !== SOURCE_ID) {
        return;
      }
      if (event.data.type === 'content-dimensions') {
        var payload = event.data.payload || {};
        var height = Number(payload.height);
        if (isFinite(height)) {
          applyContentHeight(height);
        }
      }
    }

    function handleResize() {
      setViewportHeight();
    }

    setViewportHeight();

    window.addEventListener('message', handleMessage, false);
    window.addEventListener('resize', handleResize, { passive: true });
    window.addEventListener(
      'orientationchange',
      function () {
        setTimeout(setViewportHeight, 200);
      },
      { passive: true }
    );

    if (iframe) {
      iframe.addEventListener('load', function () {
        requestAnimationFrame(function () {
          if (spinner) {
            spinner.classList.add('is-hidden');
          }
        });
      });
    }
  })();
</script>
